<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper     PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ch4.mybatis.mapper.VisitorMapper">
	
	<!-- 방문자 신청 회사명단 조회 -->
	<select id="companyList" parameterType="map" resultType="map">
		select com_no, com_reg_date, com_addr, com_hp, com_type, com_card_use, com_bizno
		from company	
	</select>
	
	<!-- 방문자 신청 부서명단 조회 -->
	<select id="deptList" parameterType="map" resultType="map">
		select dept_no, dept_name, com_no
		from dept
	</select>	
	
	<!-- 방문자 신청 신청번호 조회 -->
	<select id="applyDetail" parameterType="map" resultType="map">
	</select>
	
	<!-- 방문자 신청 신청자 정보 조회 -->
	<select id="applyList" parameterType="map" resultType="map">
	</select>
	
	<!-- 반입 신청 신청번호 조회 -->
	<select id="goodsDetail" parameterType="map" resultType="map">
	</select>
	
	<!-- 반입 신청 신청자 정보 조회 -->
	<select id="goodsList" parameterType="map" resultType="map">
	</select>
	
	<!-- 이전 방문 기록 조회 -->
	<select id="preVisitList" parameterType="map" resultType="map">
	</select>
	
	<!-- 이전 방문자관리 테이블 기록 조회 -->
	<select id="visitorList" parameterType="map" resultType="map">
		select visitor_name, visitor_hp, visit_no
		from visitor_mng
		where visit_no = #{visit_no}
	</select>
	
	<!-- 이전 반입기기관리 테이블 기록 조회 -->
	<select id="equipList" parameterType="map" resultType="map">
		select tkin_model, tkin_kind, tkin_posbl_encc, tkin_brand, visit_no
		from tkin_mng
		where visit_no = #{visit_no}
	</select>
	
	<!-- 이전 주차관리 테이블 기록 조회 -->
	<select id="carList" parameterType="map" resultType="map">
		select parking_kind, parking_num, parking_model, visit_no
		from parking_mng
		where visit_no = #{visit_no}
	</select>
	
	<!-- 신청 내용 작성 화면 추가 -->
	<insert id="visitorAdd" parameterType="map">
	</insert>
	
	<!-- 방문 신청 방문자의 정보 등록 -->
	<insert id="equipAdd" parameterType="map">
		insert into visitor_mng(visitor_name, visitor_hp, visit_no)
			values(#{visitor_name},#{visitor_hp},#{visit_no})	
	</insert>
	
	<!-- 방문 신청 반입기기의 정보 등록 -->
	<insert id="carAdd" parameterType="map">
		insert into tkin_mng(tkin_model, tkin_kind, tkin_posbl_encc, tkin_brand, visit_no)
			values(#{tkin_model}, #{tkin_kind}, #{tkin_posbl_encc}, #{tkin_brand}, #{visit_no})
	</insert>
	
	<!-- 방문 신청 차량관련 정보 등록 -->
	<insert id="visitApplyAdd" parameterType="map">
		insert into parking_mng(parking_kind, parking_num, parking_model, visit_no)
			values(#{parking_kind}, #{parking_num}, #{parking_model}, #{visit_no})
	</insert>

	<!-- 방문자의 방문신청조회 중 신청번호로 검색했을 때 전체조회 -->
	<select id="applyList" parameterType="map" resultType="map">
		select visit_no, visit_apply_name, visit_apply_date, visit_purps, visit_desti
				,visit_charge ,visit_type, visit_date, visit_apply_hp, visit_vhcle_encc
				,visit_tkin_encc, visit_permit_st, visit_notes, visit_term, visit_day
				,com_no, visitor_name, tkin_kind, parking_model
			from (
				select vi.visit_no, vi.visit_apply_name, vi.visit_apply_date, vi.visit_purps
				,vi.visit_desti, vi.visit_charge, vi.visit_type, vi.visit_date, vi.visit_apply_hp
				,vi.visit_vhcle_encc, vi.visit_tkin_encc, vi.visit_permit_st, vi.visit_notes
				,vi.visit_term, vi.visit_day, co.com_no, vir.visitor_name, tk.tkin_kind, pa.parking_model
				from visit_apply vi, visitor_mng vir, tkin_mng tk, parking_mng pa, company co
				where co.com_no = vi.com_no
				and vi.visit_no = vir.visit_no
				and vir.visit_no = tk.visit_no
				and tk.visit_no = pa.visit_no
				)
			where visit_no = #{visit_no}
	</select>
	
	<!-- 방문자의 방문신청조회 중 이름과 연락처로 검색했을 때 전체조회 -->
	<select id="applyList2" parameterType="map" resultType="map">
		select visit_no, visit_apply_name, visit_apply_date, visit_purps, visit_desti
				,visit_charge ,visit_type, visit_date, visit_apply_hp, visit_vhcle_encc
				,visit_tkin_encc, visit_permit_st, visit_notes, visit_term, visit_day
				,com_no, visitor_name, tkin_kind, parking_model
			from (
				select vi.visit_no, vi.visit_apply_name, vi.visit_apply_date, vi.visit_purps
				,vi.visit_desti, vi.visit_charge, vi.visit_type, vi.visit_date, vi.visit_apply_hp
				,vi.visit_vhcle_encc, vi.visit_tkin_encc, vi.visit_permit_st, vi.visit_notes
				,vi.visit_term, vi.visit_day, co.com_no, vir.visitor_name, tk.tkin_kind, pa.parking_model
				from visit_apply vi, visitor_mng vir, tkin_mng tk, parking_mng pa, company co
				where co.com_no = vi.com_no
				and vi.visit_no = vir.visit_no
				and vir.visit_no = tk.visit_no
				and tk.visit_no = pa.visit_no
				)
			where visit_apply_name = #{visit_apply_name} 
			and visit_apply_hp = #{visit_apply_hp}
	</select>
	
	<!-- 방문자의 방문신청조회 중 승인이 허가가 된 경우 조회 -->
	<select id="applyList3" parameterType="map" resultType="map">
		select visit_permit_id, confm_no, confm_qrcode, confm_date
			from  (
					select app.visit_permit_id, app.visit_permit_st, con.confm_no
					   		,con.confm_qrcode, con.confm_date
					from visit_confm con, visit_apply app
					where con.visit_no = app.visit_no
				  )
	</select>
	
	<!-- 방문 신청 취소 -->
	<update id="visitorCancle">
	
	</update>
	
	<!-- 방문 신청 변경 -->
	<update id="visitorUpdate">
	
	</update>
	
</mapper>