<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper     PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ch4.mybatis.mapper.InfoMapper">
	<!-- visitorQR전송 프로시저 -->
	<update id="confirmVQR" parameterType="map" statementType="CALLABLE">
		{call proc_confirmVQR(#{confm_qrcode,mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
							,#{kiosk_no,mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
							,#{msg,mode=OUT, jdbcType=VARCHAR, javaType=java.lang.String}
							,#{inout,mode=OUT, jdbcType=VARCHAR, javaType=java.lang.String}
							,#{result,mode=OUT, jdbcType=INTEGER, javaType=int}
							)}
	</update>
	
	<!-- goodsQR전송 프로시저 -->
	<update id="confirmGQR" parameterType="map" statementType="CALLABLE">
		{call proc_confirmGQR(#{confm_qrcode,mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
							,#{kiosk_no,mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
							,#{msg,mode=OUT, jdbcType=VARCHAR, javaType=java.lang.String}
							,#{inout,mode=OUT, jdbcType=VARCHAR, javaType=java.lang.String}
							,#{result,mode=OUT, jdbcType=INTEGER, javaType=int}
							)}
	</update>
	
<!-- ======================================================================== -->	
	<!-- 목적지 테이블 조회 -->
	<select id="destisearch" parameterType="map" resultType="map">
		select desti_no, desti_name, desti_lcinfo, desti_notes
				from destination
				where com_no = #{com_no}
	</select>
	
	<!-- 목적지 추가 -->
	<insert id="destiadd" parameterType="map">
		insert into destination(desti_no, desti_name, desti_lcinfo, desti_notes, com_no)
			values('DN'||to_char(systimestamp + (INTERVAL '9' HOUR),'YYYYMMDDFF3')||dbms_random.string('x',3)
					,#{desti_name},#{desti_lcinfo},#{desti_notes},#{com_no})
	</insert>
	
	<!-- 목적지 수정 -->
	<update id="destiupd" parameterType="map">
		update destination
		   set desti_name = #{desti_name}
		   	  ,desti_lcinfo = #{desti_lcinfo}
		   	  <if test="desti_notes != null">
		   	  	,desti_notes = #{desti_notes}
		   	  </if>
		 where desti_no = #{desti_no}
	</update>
	
	<!-- 목적지 삭제 -->
	<delete id="destidel" parameterType="map">
		delete desti_no, desti_name, desti_lcinfo, desti_notes
			from destination
		where desti_no = #{desti_no}
	</delete>
	
	<!-- 키오스크 조회 -->
	<select id="kiosksearch" parameterType="map" resultType="map">
		select kiosk_gate, kiosk_st, kiosk_notes, com_no
				from kiosk
		where kiosk_no = #{kiosk_no}
	</select>
	
	<!-- 키오스크 상태에 따른 조회 -->
	<select id="kioskstsearch" parameterType="map" resultType="map">
		select kiosk_no, kiosk_gate, kiosk_notes, com_no
				from kiosk
		where kiosk_st = #{kiosk_st}
	</select>
	
	<!-- 키오스크 정보 변경 -->
	<update id="kioskupd" parameterType="map">
		update kiosk
		   set kiosk_no = #{kiosk_no}
		   	  ,kiosk_gate = #{kiosk_gate}
		   	  ,kisok_st = #{kiosk_st}
		   	  <if test="kiosk_notes != null">
		   	  	,kiosk_notes = #{kiosk_notes}
		   	  </if>
		 where com_no = #{com_no}
	</update>
	
	<!-- 휴무일 조회 -->
	<select id="comclsearch" parameterType="map" resultType="map">
		select comcl_date, comcl_dayweek, comcl_notes
				from company_closeday
		<where>
		<!-- 검색 : 회사코드 -->
	   		<if test="com_no != null">
	   			and com_no = #{com_no}
	   		</if>
		<!-- 검색 : 회사 휴무날짜 (기간)-->
	   		<if test="comcl_date1 != null and comcl_date2 != null">
	   			and comcl_date >= #{comcl_date1}
	   			<![CDATA[and comcl_date <= #{comcl_date2}]]>
	   		</if>
	   	</where>	
	</select>
	
	<!-- 휴무일 추가 -->
	<insert id="comcladd" parameterType="map">
		insert into company_closeday(comcl_date, comcl_dayweek, comcl_notes, com_no)
			values(#{comcl_date}, #{comcl_dayweek}, #{comcl_dayweek}, #{comcl_notes}, #{com_no})
	</insert>
	
</mapper>  