<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper     PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ch4.mybatis.mapper.ManagerMapper">
	<!-- 회사승인자 방문신청 결제 완료 -->
	<update id="vApplyPermitUpd" parameterType="map">
		update visit_apply
		   set visit_permit_st = #{visit_permit_st}
		   	  ,visit_permit_id = #{cmng_id}
		   	  <if test="visit_notes != null">
		   	  	,visit_notes = #{visit_notes}
		   	  </if>
		 where visit_no = #{visit_no}
	</update>
	<!-- 회사승인자 방문신청 승인 -->
	<insert id="vApplyPermit" parameterType="map">
		insert into visit_confm(confm_no, confm_notes, visit_no)
		values (#{confm_no}, #{confm_notes}, #{visit_no})
	</insert>
	<!-- 회사승인자 반입신청 결제 완료 -->
	<update id="gApplyPermitUpd" parameterType="map">
		update goods_apply
		   set aplg_permit_st = #{aplg_permit_st}
		   	  ,aplg_permit_id = #{cmng_id}
		   	  <if test="aplg_notes != null">
		   	  	,aplg_notes = #{aplg_notes}
		   	  </if>
		 where aplg_no = #{aplg_no}
	</update>
	<!-- 회사승인자 반입신청 승인 -->
	<insert id="gApplyPermit" parameterType="map">
		insert into goods_confm(confm_no, aplg_no)
		values (#{confm_no}, #{aplg_no})
	</insert>
	<!-- 방문 출입 QR코드 조회 -->
	<select id="visitorQR" parameterType="map" resultType="map">
		select confm_qrcode
		  from cmg_confm
		 where confm_name = #{confm_name}
		   and confm_hp = #{confm_hp}
		   and confm_no = #{confm_no}
	</select>
	<!-- 방문 출입 QR코드 등록 -->
	<insert id = "visitorQRAdd" parameterType="map">
		insert into cmg_confm (confm_qrcode, confm_name, confm_hp, confm_no)
		values (#{confm_qrcode}, #{confm_name}, #{confm_hp}, #{confm_no}) 
	</insert>
	<!-- 승인된 반입 QR코드 조회 -->
	<select id="goodsQR" parameterType="map" resultType="map">
		select confm_qrcode
		  from goods_confm
		 where confm_no = #{confm_no}
		   and confm_name = #{confm_name}
		   and aplg_no = {aplg_no}
	</select>
	<!-- 승인된 반입 QR코드 등록 -->
	<insert id = "goodsQRAdd" parameterType="map">
		insert into goods_confm (confm_no, confm_name, confm_type, confm_date, confm_quan, confm_tkin_quan
									confm_time, confm_qrcode, aplg_no)
		values (#{confm_no}, #{confm_name}, #{confm_type}, #{confm_date}, #{confm_quan}
				,#{confm_tkin_quan}, #{confm_time}, #{confm_qrcode}, #{aplg_no}) 
	</insert>
</mapper>  